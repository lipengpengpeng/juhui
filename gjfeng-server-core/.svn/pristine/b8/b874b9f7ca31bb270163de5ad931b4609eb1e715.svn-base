package cc.messcat.gjfeng.dao.count;

import java.io.Serializable;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.time.DateFormatUtils;
import org.hibernate.type.DoubleType;
import org.springframework.stereotype.Repository;

import cc.messcat.gjfeng.common.bean.Pager;
import cc.messcat.gjfeng.common.util.BeanUtil;
import cc.messcat.gjfeng.common.util.ObjValid;
import cc.messcat.gjfeng.common.util.StringUtil;
import cc.messcat.gjfeng.common.vo.app.ResultVo;
import cc.messcat.gjfeng.dao.BaseHibernateDaoImpl;
import cc.messcat.gjfeng.entity.GjfBenefitDay;
import cc.messcat.gjfeng.entity.GjfBenefitReport;
import cc.messcat.gjfeng.entity.GjfSummaryReport;
import cc.messcat.gjfeng.entity.GjfWealOutputReport;
import cc.messcat.gjfeng.entity.GjfWealPayoutReport;
import cc.messcat.gjfeng.entity.GjfWithdrawReport;

@Repository("countInfoDao")
public class CountInfoDaoImpl extends BaseHibernateDaoImpl<Serializable>implements CountInfoDao {

	/**
	 * 余额
	 */
	@Override
	public BigDecimal findMemberBalanceMoney(String type) {
		StringBuffer sql = new StringBuffer();
		if (StringUtil.isNotBlank(type)) {
			sql.append("select COALESCE(SUM(balanceMoney),0) from GjfMemberInfo where status = '1' and type =:type ");
			return (BigDecimal) getCurrentSession().createQuery(sql.toString()).setParameter("type", type)
					.uniqueResult();
		} else {
			sql.append("select IFNULL(sum(BALANCE_MONEY_),0) from gjf_member_info where STATUS_ = '1'");
			return (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		}
	}

	/**
	 * 会员分红权总额
	 */
	@Override
	public BigDecimal findMemberDiviTotal() {
		String sql = "select IFNULL(sum(DIVIDENDS_NUM_),0) from gjf_member_info where STATUS_ = '1' and  IS_DEL_ = '1'";
		return (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
	}

	/**
	 * 商户分红权总额
	 */
	@Override
	public BigDecimal findStoreDiviTotal() {
		String sql = "select IFNULL(sum(STORE_DIVIDENDS_NUM_),0) from gjf_store_info where STORE_STATUS_ = '1' and  IS_DEL_= '1'";
		return (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
	}

	/**
	 * 分红发放总额
	 */
	@Override
	public BigDecimal findAllDiviAmount() {
		String sql = "select IFNULL(sum(TRADE_DIVI_NUM_),0) from gjf_member_trade_divi_history where TRADE_STATUS_ = '1'";
		return (BigDecimal) getCurrentSession().createSQLQuery(sql).uniqueResult();
	}

	/**
	 * 分红权实时余额
	 */
	@Override
	public BigDecimal findDiviMoneyBla(String type) {
		StringBuffer sql = new StringBuffer();
		if ("0".equals(type)) {// 会员分红实时余额
			return (BigDecimal) getCurrentSession()
					.createSQLQuery(
							"SELECT IFNULL(SUM(num),0) FROM (SELECT IF(DIVIDENDS_TOTAL_MONEY_/CUMULATIVE_MONEY_ >= 0.2,"
									+ "IF(DIVIDENDS_TOTAL_MONEY_/CUMULATIVE_MONEY_ >= 0.5,FLOOR(TRUNCATE(DIVIDENDS_NUM_/4,6)),FLOOR(TRUNCATE(DIVIDENDS_NUM_/2,6))),FLOOR(TRUNCATE(DIVIDENDS_NUM_,6))) AS num FROM gjf_member_info WHERE IS_DIVI_ = '1' AND STATUS_=1 AND IS_DEL_=1) AS totalSum")
					.uniqueResult();
		}
		if ("1".equals(type)) {// 商户分红实时余额
			sql.append(
					"SELECT FLOOR(IFNULL(SUM(STORE_DIVIDENDS_NUM_),0)) FROM gjf_store_info WHERE IS_DIVI_ = '1' AND STORE_STATUS_ ='1' AND IS_DEL_ = '1'");
			return (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		}
		return null;
	}

	/**
	 * 会员实时分红单价
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public BigDecimal findMemberDiviUnitPrice() {
		String sql = "SELECT SYS_RATIO_ sysRatio,DIVI_POOLS_RATIO_ diviPoolsRatio,ISSUE_RATIO_ issueRatio FROM gjf_benefit_info where RATIO_TYPE_ = '0'";
		List list = getCurrentSession().createSQLQuery(sql).addScalar("sysRatio", DoubleType.INSTANCE)
				.addScalar("diviPoolsRatio", DoubleType.INSTANCE).addScalar("issueRatio", DoubleType.INSTANCE).list();
		Object[] objects = (Object[]) list.get(0);
		Double sysRatio = (Double) objects[0];
		Double diviPoolsRatio = (Double) objects[1];
		Double issueRatio = (Double) objects[2];
		// 商店让利额
		BigDecimal storeBenefitMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"SELECT IFNULL(SUM(r.BENEFIT_MONEY_),0) FROM gjf_member_trade_benefit r WHERE DATE_FORMAT(r.ADD_TIME_,'%Y%m%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 0 DAY),'%Y%m%d') and r.TRADE_STATUS_='1'")
				.uniqueResult();
		// 订单的让利金额
		BigDecimal orderBenefitMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"SELECT IFNULL(SUM(r.STORE_BENEFIT_AMOUNT_),0) FROM gjf_order_info r WHERE DATE_FORMAT(r.FINISHED_TIME_,'%Y%m%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 0 DAY),'%Y%m%d') AND r.ORDER_STATUS_='3' AND (r.PAY_TYPE_='0' OR r.PAY_TYPE_='1' OR r.PAY_TYPE_='2' OR r.PAY_TYPE_='3' OR r.PAY_TYPE_='4')")
				.uniqueResult();
		// 总让利额
		BigDecimal totalBenefitMoney = (storeBenefitMoney.add(orderBenefitMoney)).setScale(2, BigDecimal.ROUND_DOWN);// 保留两位，截断多余的
		// 计算实际参与分红的分红权,取整
		BigDecimal memberTotalBenefitNum = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"SELECT FLOOR(IFNULL(SUM(NUM),0)) FROM (SELECT IF(DIVIDENDS_TOTAL_MONEY_/CUMULATIVE_MONEY_ >= 0.2,IF(DIVIDENDS_TOTAL_MONEY_/CUMULATIVE_MONEY_ >= 0.5,FLOOR(TRUNCATE(DIVIDENDS_NUM_/4,6)),FLOOR(TRUNCATE(DIVIDENDS_NUM_/2,6))),FLOOR(TRUNCATE(DIVIDENDS_NUM_,6))) AS NUM FROM gjf_member_info WHERE STATUS_='1' AND IS_DEL_='1') AS TOTAL_SUM")
				.uniqueResult();
		BigDecimal result = totalBenefitMoney
				.multiply(new BigDecimal(sysRatio.toString()).divide(new BigDecimal("100")))
				.multiply(new BigDecimal(diviPoolsRatio.toString()).divide(new BigDecimal("100")))
				.divide(new BigDecimal(issueRatio.toString()), 2, BigDecimal.ROUND_DOWN)
				.divide(memberTotalBenefitNum, 2, BigDecimal.ROUND_DOWN);
		return result;
	}

	/**
	 * 商户实时分红单价
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public BigDecimal findSellerDiviUnitPrice() {
		String sql = "SELECT SYS_RATIO_ sysRatio,DIVI_POOLS_RATIO_ diviPoolsRatio,ISSUE_RATIO_ issueRatio FROM gjf_benefit_info where RATIO_TYPE_ = '1'";
		List list = getCurrentSession().createSQLQuery(sql).addScalar("sysRatio", DoubleType.INSTANCE)
				.addScalar("diviPoolsRatio", DoubleType.INSTANCE).addScalar("issueRatio", DoubleType.INSTANCE).list();
		Object[] objects = (Object[]) list.get(0);
		Double sysRatio = (Double) objects[0];
		Double diviPoolsRatio = (Double) objects[1];
		Double issueRatio = (Double) objects[2];
		// 商店让利额
		BigDecimal storeBenefitMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"SELECT IFNULL(SUM(r.BENEFIT_MONEY_),0) FROM gjf_member_trade_benefit r WHERE DATE_FORMAT(r.ADD_TIME_,'%Y%m%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 0 DAY),'%Y%m%d') and r.TRADE_STATUS_='1'")
				.uniqueResult();
		// 订单的让利金额
		BigDecimal orderBenefitMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"SELECT IFNULL(SUM(r.STORE_BENEFIT_AMOUNT_),0) FROM gjf_order_info r WHERE DATE_FORMAT(r.FINISHED_TIME_,'%Y%m%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 0 DAY),'%Y%m%d') AND r.ORDER_STATUS_='3' AND (r.PAY_TYPE_='0' OR r.PAY_TYPE_='1' OR r.PAY_TYPE_='2' OR r.PAY_TYPE_='3' OR r.PAY_TYPE_='4')")
				.uniqueResult();
		// 总让利额
		BigDecimal totalBenefitMoney = (storeBenefitMoney.add(orderBenefitMoney)).setScale(2, BigDecimal.ROUND_DOWN);// 保留两位
		// 查询店铺总的分红权数量,取整
		BigDecimal storeBenefitNum = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"SELECT FLOOR(IFNULL(SUM(s.STORE_DIVIDENDS_NUM_),0)) FROM gjf_store_info s WHERE s.STORE_STATUS_='1' AND s.IS_DEL_='1'")
				.uniqueResult();
		BigDecimal result = totalBenefitMoney
				.multiply(new BigDecimal(sysRatio.toString()).divide(new BigDecimal("100")))
				.multiply(new BigDecimal(diviPoolsRatio.toString()).divide(new BigDecimal("100")))
				.divide(new BigDecimal(issueRatio.toString()), 2, BigDecimal.ROUND_DOWN)
				.divide(storeBenefitNum, 2, BigDecimal.ROUND_DOWN);
		return result;
	}

	/**
	 * 商户剩余授信额度
	 * 
	 * @return
	 */
	@Override
	public BigDecimal findSellerCreditLine() {
		String sql = "select IFNULL(sum(LINE_OF_CREDIT_),0) from gjf_member_info where TYPE_ = '1' and STATUS_ ='1'";
		return (BigDecimal) getCurrentSession().createSQLQuery(sql).uniqueResult();
	}

	/**
	 * 查询用户当日的订单总额
	 * 
	 * @param id
	 * @return
	 */
	@Override
	public BigDecimal findMemberOrderByday(Long id) {
		String sql = "select COALESCE(SUM(orderTotalAmount),0) from GjfOrderInfo where orderStatus IN ('1','2','3') and memberId.id = :id  AND finishedTime between :startTime and :endTime";
		return (BigDecimal) getCurrentSession().createQuery(sql.toString()).setParameter("id", id)
				.setParameter("startTime", getDayBegin()).setParameter("endTime", getDayEnd()).uniqueResult();
	}

	/**
	 * 查询总授信充值额度
	 * 
	 * @return
	 */
	@Override
	public BigDecimal findCreditLineRechargeTotal() {
		String sql = "select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_ = '0' and TRADE_STATUS_ = '1'";
		return (BigDecimal) getCurrentSession().createSQLQuery(sql).uniqueResult();
	}

	/**
	 * 查询当日授信充值额
	 * 
	 * @return
	 * @throws ParseException
	 */
	@Override
	public BigDecimal findCreditLineRecharge() throws ParseException {
		String sql = "select COALESCE(sum(applyMoney),0) from GjfMemberTrade where tradeType = '0' and  tradeStatus = '1' and addTime between :startTime and :endTime ";
		return (BigDecimal) getCurrentSession().createQuery(sql).setParameter("startTime", getDayBegin())
				.setParameter("endTime", getDayEnd()).uniqueResult();
	}

	// 获取当天的开始时间
	private Date getDayBegin() {
		Calendar cal = new GregorianCalendar();
		cal.set(Calendar.HOUR_OF_DAY, 0);
		cal.set(Calendar.MINUTE, 0);
		cal.set(Calendar.SECOND, 0);
		cal.set(Calendar.MILLISECOND, 0);
		return cal.getTime();
	}

	// 获取当天的结束时间
	private Date getDayEnd() {
		Calendar cal = new GregorianCalendar();
		cal.set(Calendar.HOUR_OF_DAY, 23);
		cal.set(Calendar.MINUTE, 59);
		cal.set(Calendar.SECOND, 59);
		return cal.getTime();
	}

	/**
	 * 查询近30天授信充值趋势
	 * 
	 * @return
	 */
	@Override
	public BigDecimal[] findAlmostOneMonthCLRecharge() {
		BigDecimal[] result = new BigDecimal[30];
		String[] date = getAlmostOneMonthDate();
		for (int i = 0; i < date.length; i++) {
			StringBuffer sql = new StringBuffer();
			if (i == 29) {
				Calendar yesterday = Calendar.getInstance();
				yesterday.add(Calendar.DATE, -1);
				String startTime = new SimpleDateFormat("yyyy-MM-dd 00:00:00").format(yesterday.getTime());
				String endTime = new SimpleDateFormat("yyyy-MM-dd 23:59:59").format(yesterday.getTime());
				sql.append(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_ = '0' and TRADE_STATUS_ = '1' and ADD_TIME_ between '")
						.append(startTime).append("' and '").append(endTime).append("'");
			} else {
				sql.append(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_ = '0' and TRADE_STATUS_ = '1' and ADD_TIME_ between '")
						.append(date[i]).append("' and '").append(date[i + 1]).append("'");
			}
			result[i] = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		}
		return result;
	}

	/**
	 * 查询当日网上商城交易额
	 * 
	 * @return
	 */
	@Override
	public BigDecimal findTodayStoreTurnover() {
		String sql = "select COALESCE(sum(orderTotalAmount),0) from GjfOrderInfo where payType NOT IN ('7','8') AND orderStatus IN ('1','2','3') and isDel = '1' and addTime between :startTime and :endTime";
		return (BigDecimal) getCurrentSession().createQuery(sql).setParameter("startTime", getDayBegin())
				.setParameter("endTime", getDayEnd()).uniqueResult();
	}

	/**
	 * 查询当日O2O交易额
	 * 
	 * @return
	 */
	@Override
	public BigDecimal findTodayO2OTurnover() {
		String sql = "select COALESCE(sum(tradeMoney),0) from GjfMemberTradeBenefit where tradeStatus = '1' and addTime between :startTime and :endTime";
		return (BigDecimal) getCurrentSession().createQuery(sql).setParameter("startTime", getDayBegin())
				.setParameter("endTime", getDayEnd()).uniqueResult();
	}

	/**
	 * 查询近30天网上商城交易额
	 * 
	 * @return
	 */
	@Override
	public BigDecimal[] findAlmostOneMonthStoreTurnover() {
		BigDecimal[] result = new BigDecimal[30];
		String[] date = getAlmostOneMonthDate();
		for (int i = 0; i < date.length; i++) {
			StringBuffer sql = new StringBuffer();
			if (i == 29) {
				Calendar yesterday = Calendar.getInstance();
				yesterday.add(Calendar.DATE, -1);
				String startTime = new SimpleDateFormat("yyyy-MM-dd 00:00:00").format(yesterday.getTime());
				String endTime = new SimpleDateFormat("yyyy-MM-dd 23:59:59").format(yesterday.getTime());
				sql.append(
						"select IFNULL(sum(ORDER_TOTAL_AMOUNT_),0) from gjf_order_info where PAY_TYPE_ NOT IN ('7','8') AND ORDER_STATUS_ = '1' and PAY_TIME_ between '")
						.append(startTime).append("' and '").append(endTime).append("'");
			} else {
				sql.append(
						"select IFNULL(sum(ORDER_TOTAL_AMOUNT_),0) from gjf_order_info where PAY_TYPE_ NOT IN ('7','8') AND ORDER_STATUS_ = '1' and PAY_TIME_ between '")
						.append(date[i]).append("' and '").append(date[i + 1]).append("'");
			}
			result[i] = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		}
		return result;
	}

	/**
	 * 查询近30天O2O交易额
	 * 
	 * @return
	 */
	@Override
	public BigDecimal[] findAlmostOneMonth020Turnover() {
		BigDecimal[] result = new BigDecimal[30];
		String[] date = getAlmostOneMonthDate();
		for (int i = 0; i < date.length; i++) {
			StringBuffer sql = new StringBuffer();
			if (i == 29) {
				Calendar yesterday = Calendar.getInstance();
				yesterday.add(Calendar.DATE, -1);
				String startTime = new SimpleDateFormat("yyyy-MM-dd 00:00:00").format(yesterday.getTime());
				String endTime = new SimpleDateFormat("yyyy-MM-dd 23:59:59").format(yesterday.getTime());
				sql.append(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_ = '1' and ADD_TIME_ between '")
						.append(startTime).append("' and '").append(endTime).append("'");
			} else {
				sql.append(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_ = '1' and ADD_TIME_ between '")
						.append(date[i]).append("' and '").append(date[i + 1]).append("'");
			}
			result[i] = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		}
		return result;
	}

	/**
	 * 查询近30天会员增加数量和趋势
	 * 
	 * @return
	 */
	@Override
	public BigInteger[] findAlmostOneMonthMemberAdd(String type) {
		BigInteger[] result = new BigInteger[30];
		String[] date = getAlmostOneMonthDate();
		for (int i = 0; i < date.length; i++) {
			StringBuffer sql = new StringBuffer();
			if (i == 29) {
				Calendar yesterday = Calendar.getInstance();
				yesterday.add(Calendar.DATE, -1);
				String startTime = new SimpleDateFormat("yyyy-MM-dd 00:00:00").format(yesterday.getTime());
				String endTime = new SimpleDateFormat("yyyy-MM-dd 23:59:59").format(yesterday.getTime());
				if (StringUtil.isNotBlank(type)) {
					sql.append("select count(1) from gjf_member_info where TYPE_ = '").append(type)
							.append("' and ADD_TIME_ between '").append(startTime).append("' and '").append(endTime)
							.append("'");
				} else {
					sql.append("select count(1) from gjf_member_info where ADD_TIME_ between '").append(startTime)
							.append("' and '").append(endTime).append("'");
				}
			} else {
				if (StringUtil.isNotBlank(type)) {
					sql.append("select count(1) from gjf_member_info where TYPE_ = '").append(type)
							.append("' and ADD_TIME_ between '").append(date[i]).append("' and '").append(date[i + 1])
							.append("'");
				} else {
					sql.append("select count(1) from gjf_member_info where ADD_TIME_ between '").append(date[i])
							.append("' and '").append(date[i + 1]).append("'");
				}
			}
			result[i] = (BigInteger) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();

		}
		return result;
	}

	/**
	 * 查询分红趋势
	 */
	@Override
	public BigDecimal[] findAlmostOneMonthBenefitDay(String type) {
		BigDecimal[] result = new BigDecimal[30];
		String[] date = getAlmostOneMonthDate();
		String value = null;
		if ("1".equals(type)) {
			value = "MEMBER_MONEY_";
		} else if ("2".equals(type)) {
			value = "MERCHANTS_MONEY_";
		} else if ("3".equals(type)) {
			value = "MEMBER_REAL_MONEY_";
		} else if ("4".equals(type)) {
			value = "MERCHANTS_REAL_MONEY_";
		}
		for (int i = 0; i < date.length; i++) {
			StringBuffer sql = new StringBuffer();
			if (i == 29) {
				Calendar yesterday = Calendar.getInstance();
				yesterday.add(Calendar.DATE, -1);
				String startTime = new SimpleDateFormat("yyyy-MM-dd 00:00:00").format(yesterday.getTime());
				String endTime = new SimpleDateFormat("yyyy-MM-dd 23:59:59").format(yesterday.getTime());
				sql.append("select IFNULL(").append(value).append(",0) from gjf_benefit_day where ACT_TIME_ >= '")
						.append(startTime).append("' and ACT_TIME_ <= '").append(endTime).append("'");
			} else {
				sql.append("select IFNULL(").append(value).append(",0) from gjf_benefit_day where ACT_TIME_ >= '")
						.append(date[i]).append("' and ACT_TIME_ < '").append(date[i + 1]).append("'");
			}
			BigDecimal temp = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
			if (ObjValid.isValid(temp)) {
				result[i] = temp;
			} else {
				result[i] = new BigDecimal("0.00");
			}
		}
		return result;
	}

	/**
	 * 查询近三个月会员的消费额,趋势
	 */
	@Override
	public BigDecimal[] findAlmostThreeMonthMemberTurnover(Long id) {
		// 包括本月的最近三个月月初和月末日期
		String[] startDate = getAlmostThreeMonth("0");
		String[] endDate = getAlmostThreeMonth("1");
		BigDecimal[] result = new BigDecimal[3];
		for (int i = 0; i < 3; i++) {
			result[i] = new BigDecimal("0.00");
			StringBuffer sql = new StringBuffer();
			sql.append(
					"select IFNULL(sum(ORDER_TOTAL_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_ IN ('1','2','3') and IS_DEL_ = '1' and MEMBER_ID_ = ")
					.append(id).append(" and PAY_TIME_ between '").append(startDate[i]).append("' and '")
					.append(endDate[i]).append("'");
			result[i] = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		}
		return result;
	}

	/**
	 * 获得近30天的日期
	 * 
	 * @return
	 */
	private String[] getAlmostOneMonthDate() {
		int n = 30;
		String[] date = new String[30];
		Calendar now = Calendar.getInstance();
		for (int i = 1; i <= date.length; i++) {
			now.add(Calendar.DATE, -1);
			String endDate = new SimpleDateFormat("yyyy-MM-dd").format(now.getTime());
			date[n - i] = endDate;
		}
		return date;
	}

	/**
	 * 获得本月以及前两月的开始日期和结束日期
	 * 
	 * @param type
	 *            0：月起始日期 1：月结束日期
	 * @return
	 */
	private String[] getAlmostThreeMonth(String type) {
		SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
		String[] date = new String[3];
		int n = 0;
		for (int i = 2; i >= 0; i--) {
			Calendar calendar = Calendar.getInstance();
			int month = calendar.get(Calendar.MONTH);
			if ("0".equals(type)) {
				calendar.add(Calendar.MONTH, -i);
				calendar.set(Calendar.DAY_OF_MONTH, 1);
				date[n] = sf.format(calendar.getTime());
			} else if ("1".equals(type)) {
				calendar.set(Calendar.MONTH, month - i);
				calendar.set(Calendar.DAY_OF_MONTH, calendar.getActualMaximum(Calendar.DAY_OF_MONTH));
				date[n] = sf.format(calendar.getTime()).toString();
			}
			n++;
		}
		return date;
	}

	/**
	 * 统计资金池
	 */
	@Override
	public BigDecimal findCashPool(String type) {
		StringBuffer sql = new StringBuffer();
		if ("5".equals(type)) {
			sql.append(
					"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where TRADE_STATUS_ IN ('0','1') and TRADE_TYPE_ = '4'");
		} else if ("6".equals(type)) {
			sql.append(
					"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where TRADE_STATUS_ IN ('0','1') and TRADE_TYPE_ = '5'");
		} else if ("7".equals(type)) {
			sql.append(
					"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where TRADE_STATUS_ IN ('0','1') and TRADE_TYPE_ = '6'");
		} else {
			sql.append(
					"select COALESCE(sum(benefitMoney),0) from GjfBenefitHistory where tradeStatus = '1' and benefitType = :benefitType");
			return (BigDecimal) getCurrentSession().createQuery(sql.toString()).setParameter("benefitType", type)
					.uniqueResult();
		}
		return (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
	}

	/**
	 * 查询提现手续费,责任险
	 * 
	 * @param type
	 *            0:手续费 1:责任险
	 * @return
	 */
	@Override
	public BigDecimal findTaxMoney(String type) {
		StringBuffer sql = new StringBuffer();
		if ("0".equals(type)) {
			sql.append(
					"select IFNULL(sum(TAX_MONEY_),0) from gjf_member_trade where TRADE_TYPE_ = '1' and TRADE_STATUS_ = '1'");
		} else if ("1".equals(type)) {
			sql.append(
					"select IFNULL(sum(INSURANCE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_ = '1' and TRADE_STATUS_ = '1'");
		}
		BigDecimal result = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		if (ObjValid.isNotValid(result)) {
			result = new BigDecimal("0.00");
		}
		return result;
	}

	/**
	 * 查询订单累计成交额
	 * 
	 * @return
	 */
	@Override
	public BigDecimal findOrderTotalAmount() {
		String sql = "select IFNULL(sum(ORDER_TOTAL_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_ = '3' and IS_DEL_ = '1' and PAY_TYPE_ NOT IN ('7','8')";
		BigDecimal temp1 = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).uniqueResult();
		String sql1 = "select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_ = '1'";
		BigDecimal temp2 = (BigDecimal) getCurrentSession().createSQLQuery(sql1.toString()).uniqueResult();
		BigDecimal result = temp1.add(temp2);
		return result;
	}

	/***** 每天定时统计 ********/
	/*
	 * 统计总报表
	 * 
	 * @see cc.messcat.gjfeng.dao.count.CountInfoDao#updateSummaryReport()
	 */
	@Override
	public ResultVo updateSummaryReport() {
		String procdureSummaryReport = "{Call gjf_calculate_summary_report_pro(?)}";
		getCurrentSession().createSQLQuery(procdureSummaryReport).setParameter(0, 1).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/*
	 * 统计让利日报表
	 * 
	 * @see cc.messcat.gjfeng.dao.count.CountInfoDao#updateBenefitReport()
	 */
	@Override
	public ResultVo updateBenefitReport() {
		String procdureBenefitReport = "{Call gjf_calculate_benefit_report_pro(?)}";
		getCurrentSession().createSQLQuery(procdureBenefitReport).setParameter(0, 1).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/*
	 * 统计福利产出日报表
	 * 
	 * @see cc.messcat.gjfeng.dao.count.CountInfoDao#updateWealOutputReport()
	 */
	@Override
	public ResultVo updateWealOutputReport() {
		String procdureWealOutputReport = "{Call gjf_calculate_output_report_pro(?)}";
		getCurrentSession().createSQLQuery(procdureWealOutputReport).setParameter(0, 1).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/*
	 * 统计福利派发报表
	 * 
	 * @see cc.messcat.gjfeng.dao.count.CountInfoDao#updateWealPayoutReport()
	 */
	@Override
	public ResultVo updateWealPayoutReport() {
		String procdureWealPayoutReport = "{Call gjf_calculate_payout_report_pro(?)}";
		getCurrentSession().createSQLQuery(procdureWealPayoutReport).setParameter(0, 1).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/*
	 * 统计提现日报表
	 * 
	 * @see cc.messcat.gjfeng.dao.count.CountInfoDao#updateWithdrawReport()
	 */
	@Override
	public ResultVo updateWithdrawReport() {
		// 1.提现成功金额
		String sql = "INSERT INTO gjf_withdraw_report(MONEY_,SUCCESS_MONEY_,FAIL_MONEY_,ADD_TIME_) VALUES("
				+ "(SELECT IFNULL(SUM(TRADE_MONEY_),0) FROM gjf_member_trade WHERE TRADE_TYPE_='1' AND (TRADE_STATUS_='1' OR TRADE_STATUS_='2') AND DATE_FORMAT(DEAL_TIME_,'%Y-%m-%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY),'%Y-%m-%d')),"
				+ "(SELECT IFNULL(SUM(TRADE_MONEY_),0) FROM gjf_member_trade WHERE TRADE_TYPE_='1' AND TRADE_STATUS_='1' AND DATE_FORMAT(DEAL_TIME_,'%Y-%m-%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY),'%Y-%m-%d')),"
				+ "(SELECT IFNULL(SUM(TRADE_MONEY_),0) FROM gjf_member_trade WHERE TRADE_TYPE_='1' AND TRADE_STATUS_='2' AND DATE_FORMAT(DEAL_TIME_,'%Y-%m-%d')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY),'%Y-%m-%d')),"
				+ "DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY),'%Y-%m-%d'))";
		getCurrentSession().createSQLQuery(sql).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/*
	 * 修改总报表和福利派发报表的福利派发为实际派发额
	 * 
	 * @see
	 * cc.messcat.gjfeng.dao.count.CountInfoDao#updateSummaryAndPayoutReport()
	 */
	public ResultVo updateSummaryAndPayoutReport() {
		String procdureSummaryAndPayoutReport = "{Call gjf_calculate_update_summary_payout_report_pro(?)}";
		getCurrentSession().createSQLQuery(procdureSummaryAndPayoutReport).setParameter(0, 1).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/*
	 * 统计资金池表
	 */
	@Override
	public ResultVo updatePoolReport() {
		String poolReport = "{Call gjf_calculate_pool_report_pro(?)}";
		getCurrentSession().createSQLQuery(poolReport).setParameter(0, 1).executeUpdate();
		return new ResultVo(200, "统计成功", null);
	}

	/***** 每天定时统计 end ********/

	/*
	 * 查询历史交易总额
	 * 
	 * @see cc.messcat.gjfeng.dao.count.CountInfoDao#findHistoryTurnover()
	 */
	@Override
	public BigDecimal findHistoryTurnover() {
		String sql = "select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_ = '1'";
		BigDecimal result = (BigDecimal) getCurrentSession().createSQLQuery(sql).uniqueResult();
		result = result.add(findOrderTurnOverByPayType("0"));
		result = result.add(findOrderTurnOverByPayType("1"));
		result = result.add(findOrderTurnOverByPayType("3"));
		result = result.add(findOrderTurnOverByPayType("4"));
		return result;
	}

	/*
	 * 根据支付方式查询订单总交易额
	 */
	public BigDecimal findOrderTurnOverByPayType(String type) {
		Map<String, Object> arrMap = new HashMap<String, Object>();
		String sql = "select COALESCE(sum(orderTotalAmount),0) from GjfOrderInfo where orderStatus IN ('1','2','3')";
		if (ObjValid.isValid(type)) {
			arrMap.put("payType", type);
			sql += " and payType = :payType";
		}
		return (BigDecimal) getCurrentSession().createQuery(sql).setProperties(arrMap).uniqueResult();
	}

	/**
	 * 统计各档分红权人数和总数
	 */
	@SuppressWarnings({ "unchecked", "rawtypes" })
	@Override
	public Map<String, Object> countDivi(String type, String min, String max) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		if ("0".equals(type)) {
			sql.append(
					"select count(DIVIDENDS_NUM_),IFNULL(sum(DIVIDENDS_NUM_),0) from gjf_member_info where STATUS_ = '1' AND IS_DEL_='1' ");
			if (StringUtil.isNotBlank(min)) {
				arrMap.put("min", min);
				sql.append(" and DIVIDENDS_NUM_ >= :min ");
			}
			if (StringUtil.isNotBlank(max)) {
				arrMap.put("max", max);
				sql.append(" and DIVIDENDS_NUM_ < :max ");
			}
		}
		if ("1".equals(type)) {
			sql.append(
					"select count(STORE_DIVIDENDS_NUM_),IFNULL(sum(STORE_DIVIDENDS_NUM_),0) from gjf_store_info where STORE_STATUS_ = '1' ");
			if (StringUtil.isNotBlank(min)) {
				arrMap.put("min", min);
				sql.append(" and STORE_DIVIDENDS_NUM_ >= :min ");
			}
			if (StringUtil.isNotBlank(max)) {
				arrMap.put("max", max);
				sql.append(" and STORE_DIVIDENDS_NUM_ < :max ");
			}
		}
		List list = getCurrentSession().createSQLQuery(sql.toString()).setProperties(arrMap).list();
		String[] param = { "amount", "totalNum" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		return (Map<String, Object>) list.get(0);
	}

	/**
	 * 查询用户未使用授信额 分页 模糊查询
	 */
	@SuppressWarnings({ "rawtypes", "unchecked" })
	@Override
	public Pager findStoreCreditLine(String storeNum, String storeName, String memeberName, int pageNo, int pageSize,
			String orderType) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append(
				"SELECT s.STORE_NUM_,s.STORE_NAME_,m.NAME_,m.LINE_OF_CREDIT_,m.ID_,m.MOBILE_ FROM gjf_store_info AS s LEFT JOIN gjf_member_info AS m ON s.MEMBER_ID_ = m.ID_ WHERE  m.TYPE_ = '1'  ");
		if (StringUtil.isNotBlank(storeNum)) {
			arrMap.put("storeNum", "%" + storeNum + "%");
			sql.append(" and s.STORE_NUM_ like :storeNum ");
		}
		if (StringUtil.isNotBlank(storeName)) {
			arrMap.put("storeName", "%" + storeName + "%");
			sql.append(" and s.STORE_NAME_ like :storeName ");
		}
		if (StringUtil.isNotBlank(memeberName)) {
			arrMap.put("memeberName", "%" + memeberName + "%");
			sql.append(" and m.NAME_ like :memeberName ");
		}
		if (ObjValid.isNotValid(orderType)) {
			sql.append(" order by m.ADD_TIME_ DESC");
		} else if ("1".equals(orderType)) {
			sql.append(" order by m.LINE_OF_CREDIT_ ASC");
		} else if ("2".equals(orderType)) {
			sql.append(" order by m.LINE_OF_CREDIT_ DESC");
		}
		List list = getCurrentSession().createSQLQuery(sql.toString()).setProperties(arrMap).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "num", "sName", "name", "creditLine", "memberId", "mobile" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sqlCount = sql.toString().replace(
				"SELECT s.STORE_NUM_,s.STORE_NAME_,m.NAME_,m.LINE_OF_CREDIT_,m.ID_,m.MOBILE_", "select count(1)");
		BigInteger count = (BigInteger) getCurrentSession().createSQLQuery(sqlCount).uniqueResult();
		Pager pager = new Pager(pageSize, pageNo, count.intValue(), list);
		return pager;
	}

	/**
	 * 区域业绩
	 * 
	 * @param pageNo
	 * @param pageSize
	 * @param provinceId
	 * @param cityId
	 * @param areaId
	 * @param startTime
	 * @param endTime
	 * @return
	 */
	@Override
	@SuppressWarnings({ "unchecked", "rawtypes" })
	public Pager findRegionalPerformance(int pageNo, int pageSize, Long provinceId, Long cityId, Long areaId,
			String startTime, String endTime) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append(" SELECT m.NAME_,s.STORE_NAME_,b.TRADE_MONEY_,b.ADD_TIME_,p.PROVINCE_,c.CITY_,a.AREA_ "
				+ " FROM gjf_member_trade_benefit b LEFT JOIN gjf_member_info m ON b.MEMBER_ID_ = m.ID_ "
				+ " LEFT JOIN gjf_store_info s ON b.STORE_ID_ = s.ID_ LEFT JOIN gjf_address_province p "
				+ " ON s.PROVINCE_ID_ = p.ID_ LEFT JOIN gjf_address_city c ON s.CITY_ID_ = c.ID_ LEFT JOIN gjf_address_area a "
				+ "ON s.AREA_ID_ = a.ID_ where b.TRADE_STATUS_ = '1' ");
		if (ObjValid.isValid(provinceId)) {
			arrMap.put("provinceId", provinceId);
			sql.append(" and p.PROVINCE_ID_ = :provinceId ");
		}
		if (ObjValid.isValid(cityId)) {
			arrMap.put("cityId", cityId);
			sql.append(" and c.CITY_ID_ = :cityId ");
		}
		if (ObjValid.isValid(areaId)) {
			arrMap.put("areaId", areaId);
			sql.append(" and a.AREA_ID_ = :areaId ");
		}
		if (ObjValid.isValid(startTime)) {
			arrMap.put("startTime", startTime);
			sql.append(" and b.ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and b.ADD_TIME_ < :endTime ");
		}
		sql.append(" order by b.ADD_TIME_ DESC");
		String sql0 = sql.toString().replace(
				"SELECT m.NAME_,s.STORE_NAME_,b.TRADE_MONEY_,b.ADD_TIME_,p.PROVINCE_,c.CITY_,a.AREA_",
				"select count(1)");
		BigInteger count = (BigInteger) getCurrentSession().createSQLQuery(sql0).setProperties(arrMap).uniqueResult();
		List list = getCurrentSession().createSQLQuery(sql.toString()).setProperties(arrMap).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "name", "storeName", "tradeMoney", "addTime", "province", "city", "area" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		Pager pager = new Pager(pageSize, pageNo, count.intValue(), list);
		return pager;
	}

	/**
	 * 统计当前条件区域业绩
	 */
	@Override
	public BigDecimal findCountRegionalPerformance(Long provinceId, Long cityId, Long areaId, String startTime,
			String endTime) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append(
				" SELECT IFNULL(sum(b.TRADE_MONEY_),0) FROM gjf_member_trade_benefit b LEFT JOIN gjf_member_info m ON b.MEMBER_ID_ = m.ID_ "
						+ " LEFT JOIN gjf_store_info s ON b.STORE_ID_ = s.ID_ LEFT JOIN gjf_address_province p "
						+ " ON s.PROVINCE_ID_ = p.ID_ LEFT JOIN gjf_address_city c ON s.CITY_ID_ = c.ID_ LEFT JOIN gjf_address_area a "
						+ "ON s.AREA_ID_ = a.ID_ where b.TRADE_STATUS_ = '1' ");
		if (ObjValid.isValid(provinceId)) {
			arrMap.put("provinceId", provinceId);
			sql.append(" and p.PROVINCE_ID_ = :provinceId ");
		}
		if (ObjValid.isValid(cityId)) {
			arrMap.put("cityId", cityId);
			sql.append(" and c.CITY_ID_ = :cityId ");
		}
		if (ObjValid.isValid(areaId)) {
			arrMap.put("areaId", areaId);
			sql.append(" and a.AREA_ID_ = :areaId ");
		}
		if (ObjValid.isValid(startTime)) {
			arrMap.put("startTime", startTime);
			sql.append(" and b.ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and b.ADD_TIME_ < :endTime ");
		}
		return (BigDecimal) getCurrentSession().createSQLQuery(sql.toString()).setProperties(arrMap).uniqueResult();
	}

	/**
	 * 根据会员类型统计会员数量
	 */
	@Override
	public BigInteger findMemberAmountByType(String type) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select count(1) from gjf_member_info where STATUS_ = '1' and IS_DEL_ = '1' ");
		if (StringUtil.isNotBlank(type)) {
			arrMap.put("type", type);
			sql.append(" and TYPE_ = :type ");
		}
		BigInteger result = (BigInteger) getCurrentSession().createSQLQuery(sql.toString()).setProperties(arrMap)
				.uniqueResult();
		return result;
	}

	/**
	 * 会员分页
	 */
	@SuppressWarnings({ "rawtypes", "unchecked" })
	@Override
	public Pager findMemberAmount(int pageNo, int pageSize) {
		String sql = "select ID_,NAME_,MOBILE_,NICK_NAME_,SEX_,CUMULATIVE_MONEY_,TYPE_ from gjf_member_info where STATUS_ = '1' and IS_DEL_ = '1' order by ADD_TIME_ DESC";
		List list = getCurrentSession().createSQLQuery(sql).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "id", "name", "mobile", "nickName", "sex", "cumulativeMoney", "type" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sqlCount = sql.replace("select ID_,NAME_,MOBILE_,NICK_NAME_,SEX_,CUMULATIVE_MONEY_,TYPE_",
				"select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).uniqueResult()).intValue(), list);
		return pager;
	}

	/**
	 * 查询总报表
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Pager findSummaryReport(int pageNo, int pageSize, String addTime, String endTime, String ste) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select * from gjf_summary_report where 1=1");
		if (ObjValid.isValid(addTime)) {
			arrMap.put("addTime", addTime);
			sql.append(" and ADD_TIME_  >= :addTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ADD_TIME_  <= :endTime ");
		}
		sql.append(" order by ADD_TIME_ DESC ");
		List list = null;
		if ("1".equals(ste)) {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfSummaryReport.class)
					.setProperties(arrMap).list();
		} else {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfSummaryReport.class)
					.setProperties(arrMap).setMaxResults(pageSize).setFirstResult((pageNo - 1) * pageSize).list();
		}
		String sqlCount = sql.toString().replace("select *", "select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setProperties(arrMap).uniqueResult())
						.intValue(),
				list);
		return pager;
	}

	/**
	 * 查询福利产出表
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Pager findWealOutputReport(int pageNo, int pageSize, String addTime, String endTime, String ste) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select * from gjf_weal_output_report where 1=1");
		if (ObjValid.isValid(addTime)) {
			arrMap.put("addTime", addTime);
			sql.append(" and ADD_TIME_  >= :addTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ADD_TIME_  <= :endTime ");
		}
		sql.append(" order by ADD_TIME_ DESC ");
		List list = null;
		if ("1".equals(ste)) {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfWealOutputReport.class)
					.setProperties(arrMap).list();
		} else {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfWealOutputReport.class)
					.setProperties(arrMap).setMaxResults(pageSize).setFirstResult((pageNo - 1) * pageSize).list();
		}
		String sqlCount = sql.toString().replace("select *", "select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setProperties(arrMap).uniqueResult())
						.intValue(),
				list);
		return pager;
	}

	/**
	 * 查询福利派发表
	 * 
	 * @param pageNo
	 * @param pageSize
	 * @param addTime
	 * @return
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Pager findWealPayoutReport(int pageNo, int pageSize, String addTime, String endTime, String ste) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select * from gjf_weal_payout_report where 1=1");
		if (ObjValid.isValid(addTime)) {
			arrMap.put("addTime", addTime);
			sql.append(" and ADD_TIME_  >= :addTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ADD_TIME_  <= :endTime ");
		}
		sql.append(" order by ADD_TIME_ DESC ");
		List list = null;
		if ("1".equals(ste)) {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfWealPayoutReport.class)
					.setProperties(arrMap).list();
		} else {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfWealPayoutReport.class)
					.setProperties(arrMap).setMaxResults(pageSize).setFirstResult((pageNo - 1) * pageSize).list();
		}
		String sqlCount = sql.toString().replace("select *", "select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setProperties(arrMap).uniqueResult())
						.intValue(),
				list);
		return pager;
	}

	/**
	 * 提现日报表
	 * 
	 * @param pageNo
	 * @param pageSize
	 * @param addTime
	 * @return
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Pager findWithdrawReport(int pageNo, int pageSize, String addTime, String endTime, String ste) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select * from gjf_withdraw_report where 1=1");
		if (ObjValid.isValid(addTime)) {
			arrMap.put("addTime", addTime);
			sql.append(" and ADD_TIME_  >= :addTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ADD_TIME_  <= :endTime ");
		}
		sql.append(" order by ADD_TIME_ DESC ");
		List list = null;
		if ("1".equals(ste)) {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfWithdrawReport.class)
					.setProperties(arrMap).list();
		} else {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfWithdrawReport.class)
					.setProperties(arrMap).setMaxResults(pageSize).setFirstResult((pageNo - 1) * pageSize).list();
		}
		String sqlCount = sql.toString().replace("select *", "select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setProperties(arrMap).uniqueResult())
						.intValue(),
				list);
		return pager;
	}

	/**
	 * 让利日报表
	 * 
	 * @param pageNo
	 * @param pageSize
	 * @param addTime
	 * @return
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Pager findBenefitReport(int pageNo, int pageSize, String addTime, String endTime, String ste) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select * from gjf_benefit_report where 1=1");
		if (ObjValid.isValid(addTime)) {
			arrMap.put("addTime", addTime);
			sql.append(" and ADD_TIME_  >= :addTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ADD_TIME_  <= :endTime ");
		}
		sql.append(" order by ADD_TIME_ DESC ");
		List list = null;
		if ("1".equals(ste)) {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfBenefitReport.class)
					.setProperties(arrMap).list();
		} else {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfBenefitReport.class)
					.setProperties(arrMap).setMaxResults(pageSize).setFirstResult((pageNo - 1) * pageSize).list();
		}
		String sqlCount = sql.toString().replace("select *", "select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setProperties(arrMap).uniqueResult())
						.intValue(),
				list);
		return pager;
	}

	/**
	 * 今日O2O订单
	 */
	@SuppressWarnings({ "rawtypes", "unchecked" })
	@Override
	public Pager findTodayO2OOrders(int pageNo, int pageSize) {
		StringBuffer sql = new StringBuffer();
		// 利用Apache lang包快速获取凌晨0点0分0秒，23点59分59秒字符串
		String startTime = DateFormatUtils.format(new Date(), "yyyy-MM-dd 00:00:00");
		String endTime = DateFormatUtils.format(new Date(), "yyyy-MM-dd 23:59:59");
		sql.append(
				"select b.TRADE_NO_,m.NAME_,s.STORE_NAME_,b.TRADE_MONEY_,b.ADD_TIME_,b.PAY_TYPE_,b.TRADE_STATUS_ from gjf_member_trade_benefit b left join gjf_member_info m on b.MEMBER_ID_ = m.ID_ left join gjf_store_info s on b.STORE_ID_ = s.ID_ where b.ADD_TIME_ between '")
				.append(startTime).append("' and '").append(endTime).append("' ");
		List list = getCurrentSession().createSQLQuery(sql.toString()).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "tradeNo", "name", "storeName", "tradeMoney", "addTime", "payType", "tradeStatus" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sql0 = sql.toString().replace(
				"select b.TRADE_NO_,m.NAME_,s.STORE_NAME_,b.TRADE_MONEY_,b.ADD_TIME_,b.PAY_TYPE_,b.TRADE_STATUS_",
				"select count(1)");
		BigInteger count = (BigInteger) getCurrentSession().createSQLQuery(sql0).uniqueResult();
		return new Pager(pageSize, pageNo, count.intValue(), list);
	}

	/**
	 * 查询池收入
	 */
	@SuppressWarnings({ "rawtypes", "unchecked" })
	@Override
	public Pager findPoolIn(int pageNo, int pageSize, String op, String type) {
		String sql = null;
		if ("1".equals(op) && "8".equals(type)) {
			sql = "select MEMBER_INCOME_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("2".equals(op) && "9".equals(type)) {
			sql = "select MERCHANTS_INCOME_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("3".equals(op) && "10".equals(type)) {
			sql = "select PLATFORM_INCOME_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("4".equals(op) && "13".equals(type)) {
			sql = "select CITYAGENT_INCOME_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("5".equals(op) && "14".equals(type)) {
			sql = "select AREAAGENT_INCOME_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("6".equals(op) && "15".equals(type)) {
			sql = "select INDIVIAGENT_INCOME_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		List list = getCurrentSession().createSQLQuery(sql).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "income", "addTime" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sqlCount = "select count(ID_) from gjf_pool_report";
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).uniqueResult()).intValue(), list);
		return pager;
	}

	/**
	 * 查询池支出
	 */
	@SuppressWarnings({ "rawtypes", "unchecked" })
	@Override
	public Pager findPoolOut(int pageNo, int pageSize, String op, String type) {
		String sql = null;
		if ("1".equals(op) && "0".equals(type)) {
			sql = "select MEMBER_EXPEND_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("2".equals(op) && "1".equals(type)) {
			sql = "select MERCHANTS_EXPEND_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("3".equals(op) && "5".equals(type)) {
			sql = "select CITYAGENT_EXPEND_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("4".equals(op) && "6".equals(type)) {
			sql = "select AREAAGENT_EXPEND_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		if ("5".equals(op) && "7".equals(type)) {
			sql = "select INDIVIAGENT_EXPEND_POOL_,ADD_TIME_ FROM gjf_pool_report order by ADD_TIME_ DESC";
		}
		List list = getCurrentSession().createSQLQuery(sql).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "expend", "addTime" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sqlCount = "select count(ID_) from gjf_pool_report";
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).uniqueResult()).intValue(), list);
		return pager;
	}

	/**
	 * 查询池收入支出明细
	 */
	@SuppressWarnings({ "unchecked", "rawtypes" })
	@Override
	public Pager findPoolDetail(int pageNo, int pageSize, String addTime, String type) {
		// 利用Apache lang包快速获取凌晨0点0分0秒，23点59分59秒字符串
		String startTime = addTime + " 00:00:00";
		String endTime = addTime + " 23:59:59";
		StringBuffer sql = new StringBuffer();
		sql.append(
				"select BENEFIT_MONEY_,BENEFIT_MONEY_BF_,BENEFIT_MONEY_AF_,UNIT_PRICE_,ADD_TIME_,BENEFIT_TIME_,TRADE_TIME_,TRADE_STATUS_ from gjf_benefit_history"
						+ " where TRADE_STATUS_ = '1' and  BENEFIT_TYPE_ = :type and ADD_TIME_ >= :startTime and ADD_TIME_ < :endTime ");
		sql.append(" order by ADD_TIME_ desc");
		List list = getCurrentSession().createSQLQuery(sql.toString()).setParameter("tradeType", type)
				.setParameter("startTime", startTime).setParameter("endTime", endTime).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "benefitMoney", "benefitMoneyBF", "benefitMoneyAF", "unitPrice", "addTime", "benefitTime",
				"tradeTime", "tradeStatus" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sqlCount = sql.toString().replace(
				"select BENEFIT_MONEY_,BENEFIT_MONEY_BF_,BENEFIT_MONEY_AF_,UNIT_PRICE_,ADD_TIME_,BENEFIT_TIME_,TRADE_TIME_,TRADE_STATUS_",
				"select count(ID_) ");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setParameter("tradeType", type)
						.setParameter("startTime", startTime).setParameter("endTime", endTime).uniqueResult())
								.intValue(),
				list);
		return pager;
	}

	@Override
	public Pager findTradeDiviByAgent(int pageNo, int pageSize, String addTime, String type) {
		// 利用Apache lang包快速获取凌晨0点0分0秒，23点59分59秒字符串
		String startTime = addTime + " 00:00:00";
		String endTime = addTime + " 23:59:59";
		String sql = "select TRADE_NO_,TRADE_MONEY_,TRADE_DIVI_NUM_,TRADE_UNIT_,TRADE_REAL_UNIT_,ADD_TIME_,TRADE_STATUS_ from gjf_member_trade_divi_history where TRADE_STATUS_ IN ('0','1') and TRADE_TYPE_ = :tradeType AND ADD_TIME_ >= :startTime and ADD_TIME_ < :endTime";
		List list = getCurrentSession().createSQLQuery(sql.toString()).setParameter("tradeType", type)
				.setParameter("startTime", startTime).setParameter("endTime", endTime).setMaxResults(pageSize)
				.setFirstResult((pageNo - 1) * pageSize).list();
		String[] param = { "tradeNo", "tradeMoney", "diviNum", "unit", "realUnit", "addTime", "tradeStatus" };
		list = BeanUtil.changeObjectArrayToMaps(list, param);
		String sqlCount = sql.toString().replace(
				"select TRADE_NO_,TRADE_MONEY_,TRADE_DIVI_NUM_,TRADE_UNIT_,TRADE_REAL_UNIT_,ADD_TIME_,TRADE_STATUS_",
				"select count(ID_) ");
		BigInteger count = (BigInteger) getCurrentSession().createSQLQuery(sqlCount).setParameter("tradeType", type)
				.setParameter("startTime", startTime).setParameter("endTime", endTime).uniqueResult();
		Pager pager = new Pager(pageSize, pageNo, count.intValue(), list);
		return pager;
	}

	/**
	 * 获取每天销售录入的统计数据
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Map countBenefitByTime(String addTime) {
		Map<String, BigDecimal> map = new HashMap<>();

		// 统计每天的让利记录 微信支付
		BigDecimal sumBeTradeMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1  and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumBeTradeMoney", sumBeTradeMoney);

		// 统计每天的让利记录 微信支付
		BigDecimal sumBeWpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(BENEFIT_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and PAY_TYPE_=0 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumBeWpay", sumBeWpay);
		// 统计每天的让利记录 银联支付
		BigDecimal sumBeHpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(BENEFIT_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and PAY_TYPE_=2 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumBeHpay", sumBeHpay);
		// 统计每天的让利记录 授信支付
		BigDecimal sumBeSpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(BENEFIT_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and PAY_TYPE_=4 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumBeSpay", sumBeSpay);
		// 统计每天的商城订单记录 余额支付
		BigDecimal sumOrderYpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=0 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumOrderYpay", sumOrderYpay);
		// 统计每天的商城订单记录 微信支付
		BigDecimal sumOrderWpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=1 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumOrderWpay", sumOrderWpay);
		// 统计每天的商城订单记录 银联支付
		BigDecimal sumOrderHpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=3 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumOrderHpay", sumOrderHpay);
		// 统计每天的商城订单记录 责任消费支付
		BigDecimal sumOrderDpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=8 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumOrderDpay", sumOrderDpay);
		// 统计每天授信记录 微信支付
		BigDecimal sumSXWpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_=1 and TRADE_STATUS_=1 and PAY_TYPE_=1 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumSXWpay", sumSXWpay);
		// 统计每天授信记录 银联支付
		BigDecimal sumSXHpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_=1 and TRADE_STATUS_=1 and PAY_TYPE_=3 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumSXHpay", sumSXHpay);
		// 统计每天授信记录 后台充值支付
		BigDecimal sumSXHTpay = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_=1 and TRADE_STATUS_=1 and PAY_TYPE_=5 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("sumSXHTpay", sumSXHTpay);

		// 直推会员奖励
		BigDecimal directMeMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(DIRECT_MEMBER_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1  and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("directMeMoney", directMeMoney);

		// 直推商家奖励
		BigDecimal directChMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(DIRECT_MERCHANTS_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("directChMoney", directChMoney);

		// 提现交易总额
		BigDecimal tradeMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_STATUS_=1 and TRADE_TYPE_=1 and DATE_FORMAT(DEAL_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("tradeMoney", tradeMoney);

		// 提现税收总额
		BigDecimal taxMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TAX_MONEY_),0) from gjf_member_trade where TRADE_STATUS_=1 and TRADE_TYPE_=1 and DATE_FORMAT(DEAL_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("taxMoney", taxMoney);

		// 提现税收总额
		BigDecimal insMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(INSURANCE_MONEY_),0) from gjf_member_trade where TRADE_STATUS_=1 and TRADE_TYPE_=1 and DATE_FORMAT(DEAL_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("insMoney", insMoney);

		// 每天新增会员数量
		BigInteger newMember = (BigInteger) getCurrentSession()
				.createSQLQuery("select count(*) from gjf_member_info where DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		BigDecimal newMem = new BigDecimal(newMember);
		map.put("newMember", newMem);

		// 每天新增商户数量
		BigInteger newMc = (BigInteger) getCurrentSession()
				.createSQLQuery(
						"select count(*) from gjf_store_info where DATE_FORMAT(STORE_ADUIT_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		BigDecimal newM = new BigDecimal(newMc);
		map.put("newMc", newM);

		// 获取个代分红金额
		BigDecimal generationMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where TRADE_TYPE_=6 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("generationMoney", generationMoney);

		// 获取区代分红金额
		BigDecimal areaGenerationMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where  TRADE_TYPE_=5 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("areaGenerationMoney", areaGenerationMoney);
		// 获取市代分红金额
		BigDecimal cityGenerationMoney = (BigDecimal) getCurrentSession()
				.createSQLQuery(
						"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where  TRADE_TYPE_=4 and DATE_FORMAT(ADD_TIME_,'%Y%m%d')=:addTime")
				.setParameter("addTime", addTime).uniqueResult();
		map.put("cityGenerationMoney", cityGenerationMoney);

		return map;
	}

	@SuppressWarnings("rawtypes")
	@Override
	public Map countTotalDataInfo(String beginTime, String endTime) {
		Map<String, BigDecimal> map = new HashMap<>();
		Map<String, Object> arrMap = new HashMap<String, Object>();

		// 统计销售录入 微信支付总额
		StringBuffer sql = new StringBuffer();
		sql.append("select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalBeTradeMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalBeTradeMoney", totalBeTradeMoney);

		// 统计销售录入 微信支付总额
		StringBuffer sql0 = new StringBuffer();
		sql0.append(
				"select IFNULL(sum(BENEFIT_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and PAY_TYPE_=0 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql0.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql0.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalBeWpay = (BigDecimal) getCurrentSession().createSQLQuery(sql0.toString()).setProperties(arrMap)
				.uniqueResult();
		map.put("totalBeWpay", totalBeWpay);

		// 统计销售录入 银联支付总额
		StringBuffer sql1 = new StringBuffer();
		sql1.append(
				"select IFNULL(sum(BENEFIT_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and PAY_TYPE_=2 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql1.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql1.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalBeHpay = (BigDecimal) getCurrentSession().createSQLQuery(sql1.toString()).setProperties(arrMap)
				.uniqueResult();
		map.put("totalBeHpay", totalBeHpay);

		// 统计销售录入 银联支付总额
		StringBuffer sql2 = new StringBuffer();
		sql2.append(
				"select IFNULL(sum(BENEFIT_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 and PAY_TYPE_=4 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql2.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql2.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalBeSpay = (BigDecimal) getCurrentSession().createSQLQuery(sql2.toString()).setProperties(arrMap)
				.uniqueResult();
		map.put("totalBeSpay", totalBeSpay);

		// 统计每天的商城订单记录 余额支付
		StringBuffer sql3 = new StringBuffer();
		sql3.append(
				"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=0 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql3.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql3.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalOrderYpay = (BigDecimal) getCurrentSession().createSQLQuery(sql3.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalOrderYpay", totalOrderYpay);

		// 统计每天的商城订单记录 微信支付
		StringBuffer sql4 = new StringBuffer();
		sql4.append(
				"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql4.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql4.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalOrderWpay = (BigDecimal) getCurrentSession().createSQLQuery(sql4.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalOrderWpay", totalOrderWpay);

		// 统计每天的商城订单记录 银联支付
		StringBuffer sql5 = new StringBuffer();
		sql5.append(
				"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=3 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql5.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql5.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalOrderHpay = (BigDecimal) getCurrentSession().createSQLQuery(sql5.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalOrderHpay", totalOrderHpay);

		// 统计每天的商城订单记录 银联支付
		StringBuffer sql6 = new StringBuffer();
		sql6.append(
				"select IFNULL(sum(REAL_PAY_AMOUNT_),0) from gjf_order_info where ORDER_STATUS_=1 and PAY_TYPE_=8 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql6.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql6.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalOrderDpay = (BigDecimal) getCurrentSession().createSQLQuery(sql6.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalOrderDpay", totalOrderDpay);

		// 统计每天授信记录 微信支付
		StringBuffer sql7 = new StringBuffer();
		sql7.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_=1 and TRADE_STATUS_=1 and PAY_TYPE_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql7.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql7.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalSHWpay = (BigDecimal) getCurrentSession().createSQLQuery(sql7.toString()).setProperties(arrMap)
				.uniqueResult();
		map.put("totalSHWpay", totalSHWpay);

		// 统计每天授信记录 网银支付
		StringBuffer sql8 = new StringBuffer();
		sql8.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_=1 and TRADE_STATUS_=1 and PAY_TYPE_=3");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql8.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql8.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalSHHpay = (BigDecimal) getCurrentSession().createSQLQuery(sql8.toString()).setProperties(arrMap)
				.uniqueResult();
		map.put("totalSHHpay", totalSHHpay);

		// 统计每天授信记录 网银支付
		StringBuffer sql9 = new StringBuffer();
		sql9.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_TYPE_=1 and TRADE_STATUS_=1 and PAY_TYPE_=5");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql9.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql9.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalSHHTpay = (BigDecimal) getCurrentSession().createSQLQuery(sql9.toString()).setProperties(arrMap)
				.uniqueResult();
		map.put("totalSHHTpay", totalSHHTpay);

		// 直推会员奖励

		StringBuffer sql10 = new StringBuffer();
		sql10.append("select IFNULL(sum(DIRECT_MEMBER_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql10.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql10.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalDirectMeMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql10.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalDirectMeMoney", totalDirectMeMoney);

		// 直推商家奖励
		StringBuffer sql11 = new StringBuffer();
		sql11.append(
				"select IFNULL(sum(DIRECT_MERCHANTS_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql11.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql11.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalDirectChMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql11.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalDirectChMoney", totalDirectChMoney);

		// 提现交易总额
		StringBuffer sql12 = new StringBuffer();
		sql12.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade where TRADE_STATUS_=1 and TRADE_TYPE_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql12.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql12.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalTradeMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql12.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalTradeMoney", totalTradeMoney);

		// 提现税收总额
		StringBuffer sql13 = new StringBuffer();
		sql13.append("select IFNULL(sum(TAX_MONEY_),0) from gjf_member_trade where TRADE_STATUS_=1 and TRADE_TYPE_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql13.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql13.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalTaxMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql13.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalTaxMoney", totalTaxMoney);

		// 提现税收总额
		StringBuffer sql14 = new StringBuffer();
		sql14.append(
				"select IFNULL(sum(INSURANCE_MONEY_),0) from gjf_member_trade where TRADE_STATUS_=1 and TRADE_TYPE_=1 ");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql14.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql14.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalInsMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql14.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalInsMoney", totalInsMoney);

		// 会员发放总金额
		StringBuffer sql15 = new StringBuffer();
		sql15.append("select IFNULL(sum(MEMBER_REAL_MONEY_),0) from gjf_benefit_day where TRADE_STATUS_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql15.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql15.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalMeMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql15.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalMeMoney", totalMeMoney);

		// 商家发放总金额
		StringBuffer sql16 = new StringBuffer();
		sql16.append("select IFNULL(sum(MERCHANTS_REAL_MONEY_),0) from gjf_benefit_day where TRADE_STATUS_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql16.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql16.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalChMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql16.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalChMoney", totalChMoney);

		// 会员池总金额
		StringBuffer sql17 = new StringBuffer();
		sql17.append("select IFNULL(sum(MEMBER_INCOME_MONEY_),0) from gjf_benefit_day where TRADE_STATUS_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql17.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql17.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalMeIcomMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql17.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalMeIcomMoney", totalMeIcomMoney);

		// 商家池总金额
		StringBuffer sql18 = new StringBuffer();
		sql18.append("select IFNULL(sum(MERCHANTS_INCOME_MONEY_),0) from gjf_benefit_day where TRADE_STATUS_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql18.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql18.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalChIcomMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql18.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalChIcomMoney", totalChIcomMoney);

		// 直推会员奖励总金额
		StringBuffer sql19 = new StringBuffer();
		sql19.append("select IFNULL(sum(DIRECT_MEMBER_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql19.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql19.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalDirMeMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql19.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalDirMeMoney", totalDirMeMoney);

		// 直推商家奖励总金额
		StringBuffer sql20 = new StringBuffer();
		sql20.append(
				"select IFNULL(sum(DIRECT_MERCHANTS_MONEY_),0) from gjf_member_trade_benefit where TRADE_STATUS_=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql20.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql20.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalDirChMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql20.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalDirChMoney", totalDirChMoney);

		// 会员总数
		StringBuffer sql21 = new StringBuffer();
		sql21.append("select count(*) from gjf_member_info where 1=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql21.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql21.append(" and ADD_TIME_ < :endTime ");
		}
		BigInteger totalMember = (BigInteger) getCurrentSession().createSQLQuery(sql21.toString()).setProperties(arrMap)
				.uniqueResult();
		BigDecimal newM = new BigDecimal(totalMember);
		map.put("totalMember", newM);

		// 商家总数
		StringBuffer sql22 = new StringBuffer();
		sql22.append("select count(*) from gjf_store_info where 1=1");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql22.append(" and STORE_ADUIT_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql22.append(" and STORE_ADUIT_TIME_ < :endTime ");
		}
		BigInteger totalMch = (BigInteger) getCurrentSession().createSQLQuery(sql22.toString()).setProperties(arrMap)
				.uniqueResult();
		BigDecimal newMc = new BigDecimal(totalMch);
		map.put("totalMch", newMc);

		// 获取统计个代总金额
		StringBuffer sql23 = new StringBuffer();
		sql23.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where  TRADE_TYPE_=6");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql23.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql23.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalGenerationMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql23.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalGenerationMoney", totalGenerationMoney);

		// 获取统计个代总金额
		StringBuffer sql24 = new StringBuffer();
		sql24.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where  TRADE_TYPE_=5");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql24.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql24.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalAreaGenerationMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql24.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalAreaGenerationMoney", totalAreaGenerationMoney);

		// 获取统计区代总金额
		StringBuffer sql25 = new StringBuffer();
		sql25.append(
				"select IFNULL(sum(TRADE_MONEY_),0) from gjf_member_trade_divi_history where TRADE_TYPE_=4");
		if (ObjValid.isValid(beginTime)) {
			arrMap.put("startTime", beginTime);
			sql25.append(" and ADD_TIME_ >= :startTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql25.append(" and ADD_TIME_ < :endTime ");
		}
		BigDecimal totalCityGenerationMoney = (BigDecimal) getCurrentSession().createSQLQuery(sql25.toString())
				.setProperties(arrMap).uniqueResult();
		map.put("totalCityGenerationMoney", totalCityGenerationMoney);

		return map;
	}

	/**
	 * 查询福利产出表
	 */
	@SuppressWarnings("rawtypes")
	@Override
	public Pager findBenefitDay(int pageNo, int pageSize, String addTime, String endTime, String ste) {
		StringBuffer sql = new StringBuffer();
		Map<String, Object> arrMap = new HashMap<String, Object>();
		sql.append("select * from gjf_benefit_day where  TRADE_STATUS_=1");
		if (ObjValid.isValid(addTime)) {
			arrMap.put("addTime", addTime);
			sql.append(" and ACT_TIME_  >= :addTime ");
		}
		if (ObjValid.isValid(endTime)) {
			arrMap.put("endTime", endTime);
			sql.append(" and ACT_TIME_  <= :endTime ");
		}
		sql.append(" order by ACT_TIME_ DESC ");
		List list = null;
		if ("1".equals(ste)) {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfBenefitDay.class)
					.setProperties(arrMap).list();
		} else {
			list = getCurrentSession().createSQLQuery(sql.toString()).addEntity(GjfBenefitDay.class)
					.setProperties(arrMap).setMaxResults(pageSize).setFirstResult((pageNo - 1) * pageSize).list();
		}
		String sqlCount = sql.toString().replace("select *", "select count(1)");
		Pager pager = new Pager(pageSize, pageNo,
				((BigInteger) getCurrentSession().createSQLQuery(sqlCount).setProperties(arrMap).uniqueResult())
						.intValue(),
				list);
		return pager;
	}

}
